<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guildforge | Register</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

  <style>
    *{ box-sizing:border-box; margin:0; padding:0; }

    :root{
      --bg0:#07090c;
      --bg1:#0b0f14;
      --panel:#0e131a;
      --panel2:#0a0f15;

      --ink:#d7dbe2;
      --muted:#9aa3af;

      --iron:#2b3440;
      --ember:#b64b2e;
      --blood:#7a1e1e;
      --bone:#c9b89a;

      --shadow: rgba(0,0,0,.60);
      --frame: rgba(255,255,255,.04);
      --glass: rgba(0,0,0,.18);
    }

    body{
      min-height:100vh;
      color: var(--ink);
      font-family: 'Cinzel', ui-serif, Georgia, "Times New Roman", serif;

      display:grid;
      place-items:center;

      background:
        radial-gradient(1100px 600px at 18% 0%, rgba(182,75,46,.12), transparent 60%),
        radial-gradient(900px 500px at 82% 10%, rgba(122,30,30,.08), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
    }

    /* grit overlay */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:100;
      background: url("/images/backgrounds/register.png") center center / cover no-repeat;

    }

    .box{
      width: min(440px, 92vw);
      padding: 22px 20px 18px;
      border-radius: 14px;
      text-align:center;
      position:relative;

      border: 1px solid rgba(43,52,64,.95);
      background:
        radial-gradient(900px 260px at 18% 0%, rgba(182,75,46,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.22)),
        linear-gradient(180deg, var(--panel), var(--panel2));

      box-shadow: 0 18px 40px rgba(0,0,0,.65), inset 0 1px 0 rgba(255,255,255,.06);
      animation: fadeIn 1.0s ease;
    }

    .box::before{
      content:"";
      position:absolute;
      inset:10px;
      pointer-events:none;
      border: 0;
      border-radius: 12px;
    }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(12px); }
      to{ opacity:1; transform: translateY(0); }
    }

    h2{
      margin: 0 0 14px;
      letter-spacing: 2.6px;
      text-transform: uppercase;
      color: var(--bone);
      text-shadow:
        0 0 10px rgba(182,75,46,.20),
        0 10px 18px rgba(0,0,0,.85);
      font-size: 20px;
      position:relative;
      z-index:1;
    }

    input, select, button{
      display:block;
      width:100%;
      margin: 10px auto;
      text-align:center;
      position:relative;
      z-index:1;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    input, select{
      padding: 11px 12px;
      border-radius: 10px;

      background: rgba(0,0,0,.22);
      border: 1px solid rgba(43,52,64,.95);
      color: var(--ink);

      box-shadow:
        inset 0 0 12px rgba(0,0,0,.75),
        inset 0 1px 0 rgba(255,255,255,.05);
      outline:none;
      font-size: 14px;
    }

    input::placeholder{ color: rgba(154,163,175,.85); }

    input:focus, select:focus{
      border-color: rgba(182,75,46,.55);
      box-shadow:
        0 0 0 1px rgba(182,75,46,.12),
        inset 0 0 12px rgba(0,0,0,.75),
        inset 0 1px 0 rgba(255,255,255,.05);
    }

    /* Select arrow â€” keep it simple and clean */
    select{
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(215,219,226,.85) 50%),
        linear-gradient(135deg, rgba(215,219,226,.85) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(50% - 3px),
        calc(100% - 12px) calc(50% - 3px);
      background-size: 6px 6px;
      background-repeat: no-repeat;
      padding-right: 30px;
      cursor:pointer;
    }

    button{
      padding: 12px;
      margin-top: 14px;
      border-radius: 10px;

      border: 1px solid rgba(182,75,46,.55);
      background: linear-gradient(180deg, rgba(182,75,46,.92), rgba(122,30,30,.88));
      color: #f3e7db;

      font-weight: 900;
      font-size: 13px;
      letter-spacing: .7px;
      text-transform: uppercase;

      cursor:pointer;
      transition: .12s ease;
      box-shadow: 0 14px 28px rgba(0,0,0,.65), inset 0 1px 0 rgba(255,255,255,.12);
    }

    button:hover{
      filter: brightness(1.06);
      transform: translateY(-1px);
    }

    button:active{
      transform: translateY(0) scale(.99);
    }

    #msg{
      margin-top: 10px;
      min-height: 18px;
      font-size: 13px;
      color: #ffd6d6;
      text-shadow: 0 0 3px black;
      position:relative;
      z-index:1;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .login-link{
      margin-top: 14px;
      position:relative;
      z-index:1;
    }

    .login-link a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 8px 10px;

      border-radius: 10px;
      border: 1px solid rgba(43,52,64,.95);
      background: rgba(0,0,0,.18);

      color: var(--ink);
      text-decoration:none;

      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .5px;
      text-transform: uppercase;

      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      transition: .12s ease;
    }

    .login-link a:hover{
      border-color: rgba(182,75,46,.45);
      transform: translateY(-1px);
    }

    /* --- CLASS INFO PANEL --- */
    .class-panel{
      margin-top: 8px;
      padding: 12px 12px 10px;
      border-radius: 12px;
      border: 1px solid rgba(43,52,64,.95);
      background:
        radial-gradient(700px 180px at 20% 0%, rgba(182,75,46,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.22)),
        linear-gradient(180deg, var(--panel), var(--panel2));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      position:relative;
      z-index:1;
      text-align:left;

      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .class-title{
      font-family: 'Cinzel', ui-serif, Georgia, "Times New Roman", serif;
      letter-spacing: 1.4px;
      text-transform: uppercase;
      color: var(--bone);
      font-size: 13px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .class-tagline{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
      margin-bottom: 10px;
    }

    .class-grid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .class-block{
      padding: 8px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.04);
      background: rgba(0,0,0,.18);
    }

    .class-label{
      color: rgba(154,163,175,.92);
      font-size: 11px;
      letter-spacing: .5px;
      text-transform: uppercase;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .class-value{
      color: var(--ink);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.3;
    }

    .class-stats{ margin-top: 10px; }

    .stats-row{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .stat-chip{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.05);
      background: rgba(0,0,0,.18);
      cursor: help;
      user-select:none;
    }

    .stat-name{
      font-size: 11px;
      letter-spacing: .4px;
      text-transform: uppercase;
      color: rgba(154,163,175,.92);
      font-weight: 900;
    }

    .stat-val{
      font-size: 12px;
      font-weight: 900;
      color: var(--ink);
    }

    /* tooltip */
    .tip{
      position:absolute;
      left: 0;
      top: calc(100% + 8px);
      width: 270px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(43,52,64,.95);
      background: rgba(9,12,16,.96);
      box-shadow: 0 18px 40px rgba(0,0,0,.75), inset 0 1px 0 rgba(255,255,255,.06);
      color: var(--ink);
      font-size: 12px;
      line-height: 1.35;
      opacity: 0;
      pointer-events:none;
      transform: translateY(-4px);
      transition: .15s ease;
      z-index: 10000;
    }

    .stat-chip:hover .tip{
      opacity: 1;
      transform: translateY(0);
    }

    .tip-title{
      font-weight: 900;
      margin-bottom: 6px;
      letter-spacing: .4px;
    }

    .tip-body{
      color: rgba(215,219,226,.92);
    }

    .scaling-row{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.04);
      font-size: 12px;
    }

    /* responsive: stack blocks on small screens */
    @media (max-width: 420px){
      .class-grid{ grid-template-columns: 1fr; }
      .box{ padding: 18px 16px 16px; }
      h2{ font-size: 18px; letter-spacing: 2px; }
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>Create Adventurer</h2>

    <input id="name" placeholder="Username">
    <input id="email" placeholder="Email">

    <select id="class">
      <option disabled selected>Loading Classes...</option>
    </select>


    <input type="password" id="pass1" placeholder="Password">
    <input type="password" id="pass2" placeholder="Confirm Password">

    <!-- Class panel moved directly under class selection -->
    <div class="class-panel" id="classPanel" aria-live="polite">
      <div class="class-title" id="classTitle">Choose your path</div>
      <div class="class-tagline" id="classTagline">A name alone does not forge a legend.</div>

      <div class="class-grid">
        <div class="class-block">
          <div class="class-label">Role</div>
          <div class="class-value" id="classRole">â€”</div>
        </div>

        <div class="class-block">
          <div class="class-label">Strengths</div>
          <div class="class-value" id="classStrengths">â€”</div>
        </div>

        <div class="class-block">
          <div class="class-label">Weakness</div>
          <div class="class-value" id="classWeakness">â€”</div>
        </div>
      </div>

      <div class="class-stats">
        <div class="class-title" style="margin-top:10px;">Starting Attributes</div>

        <div class="stats-row" id="statsRow"></div>

        <div class="scaling-row">
          <div class="stat-chip">
            <span class="stat-name">Damage Scaling</span>
            <span class="stat-val" id="damageScaling">â€”</span>
            <div class="tip">
              <div class="tip-title">Damage Scaling</div>
              <div class="tip-body" id="damageScalingTip">
                Determines which attribute increases the damage of your attacks and skills.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <button onclick="register()">Forge Character</button>

    <div id="msg"></div>

    <div class="login-link">
      <a href="/login.html">Return to Gate</a>
    </div>
  </div>

  <script>
    // Flavor (front-end)
    const CLASS_INFO = {
      Warrior: { title:"Warrior", tagline:"A disciplined shield between the realm and ruin.", role:"Frontline Tank / Bruiser", strengths:"ðŸ›¡ High Defense, â¤ï¸ Durable, âš” Reliable damage", weakness:"ðŸƒ Lower mobility" },
      Berserker:{ title:"Berserker", tagline:"Unrelenting force. The forge favors the fearless.", role:"Frontline Damage", strengths:"âš” High Attack, ðŸŽ¯ Crit spikes, â¤ï¸ Brawling power", weakness:"ðŸ›¡ Less mitigation" },
      Ranger:   { title:"Ranger", tagline:"Swift hunter of the wild roadsâ€”strike, vanish, repeat.", role:"Skirmisher / DPS", strengths:"ðŸƒ Mobility, ðŸŽ¯ Precision, âš” Consistent damage", weakness:"â¤ï¸ Fragile if caught" },
      Marksman: { title:"Marksman", tagline:"One shot. One breath. One legend carved at range.", role:"Ranged DPS", strengths:"ðŸŽ¯ High accuracy, âš” Burst windows, ðŸ§  Tactical play", weakness:"ðŸ›¡ Weak at close range" },
      Mage:     { title:"Mage", tagline:"Arcane power shaped into purposeâ€”bright, dangerous, absolute.", role:"Arcanist / DPS", strengths:"ðŸ§  Intellect scaling, âš” Spell burst, âœ¨ Utility", weakness:"â¤ï¸ Low survivability" },
      Warlock:  { title:"Warlock", tagline:"Power taken, not given. Every spell has a price.", role:"Arcanist / Damage + Debuffs", strengths:"âœ¨ Curses, âš” Pressure damage, ðŸ§  Control", weakness:"â¤ï¸ Risky sustain" },
      Cleric:   { title:"Cleric", tagline:"Faith made steel. Keep allies standing when all else fails.", role:"Divine Support", strengths:"âœ¨ Healing, ðŸ›¡ Protection, ðŸ§  Team value", weakness:"âš” Lower solo damage" },
      Druid:    { title:"Druid", tagline:"Nature answers those who listenâ€”roots, storms, renewal.", role:"Divine Hybrid", strengths:"âœ¨ Sustained support, ðŸ§  Versatility, âš” Flexible play", weakness:"ðŸŽ¯ Lower burst" }
    };

    // Stat explanations (tooltips) â€” now includes HP/SP
    const STAT_DEFS = {
      attack:    { label: "Attack",    desc: "Increases physical damage and improves the power of weapon-based skills." },
      defense:   { label: "Defense",   desc: "Reduces incoming physical damage. Higher Defense makes you harder to bring down in frontline fights." },
      agility:   { label: "Agility",   desc: "Improves speed and responsiveness in combat. Often affects evasion and certain cooldown or initiative interactions (depending on your rules)." },
      vitality:  { label: "Vitality",  desc: "Increases maximum HP and improves survivability. Vitality-heavy builds last longer in extended fights." },
      intellect: { label: "Intellect", desc: "Increases magical damage and improves the power of spell-based abilities." },
      crit:      { label: "Critical",  desc: "Increases chance for critical hits (and/or crit effectiveness depending on your combat rules)." },
      hpoints:   { label: "HP",        desc: "Health Points. When HP reaches 0, you fall in battle." },
      spoints:   { label: "SP",        desc: "Skill Points. Spent to use abilities and special skills." }
    };

    // DB rows keyed by class name
    const DB_CLASSES = new Map();

    // Damage scaling rule (front-end). Recommended: move to DB as damage_stat later.
    function getDamageScalingStat(className) {
      const melee = ["Warrior","Berserker","Ranger","Marksman"];
      const caster = ["Mage","Warlock","Cleric","Druid"];

      if (melee.includes(className)) return "Attack";
      if (caster.includes(className)) return "Intellect";
      return "Attack";
    }

    function renderStatsFromDb(dbRow) {
      const statsRow = document.getElementById("statsRow");
      if (!dbRow) { statsRow.innerHTML = ""; return; }

      const statPairs = [
        ["attack", dbRow.attack],
        ["defense", dbRow.defense],
        ["agility", dbRow.agility],
        ["vitality", dbRow.vitality],
        ["intellect", dbRow.intellect],
        ["crit", dbRow.crit],
        ["hpoints", dbRow.hpoints],
        ["spoints", dbRow.spoints]
      ];

      statsRow.innerHTML = statPairs.map(([key, val]) => {
        const def = STAT_DEFS[key];
        const safeVal = (val ?? 0);
        const shownVal = (key === "crit") ? `${safeVal}%` : safeVal;

        return `
          <div class="stat-chip">
            <span class="stat-name">${def.label}</span>
            <span class="stat-val">${shownVal}</span>
            <div class="tip">
              <div class="tip-title">${def.label}</div>
              <div class="tip-body">${def.desc}</div>
            </div>
          </div>
        `;
      }).join("");
    }

    function setClassPanel(className) {
      const info = CLASS_INFO[className];

      document.getElementById("classTitle").textContent = info?.title || className || "Choose your path";
      document.getElementById("classTagline").textContent = info?.tagline || "A name alone does not forge a legend.";
      document.getElementById("classRole").textContent = info?.role || "â€”";
      document.getElementById("classStrengths").textContent = info?.strengths || "â€”";
      document.getElementById("classWeakness").textContent = info?.weakness || "â€”";

      const dbRow = DB_CLASSES.get(className);
      renderStatsFromDb(dbRow);

      const scale = getDamageScalingStat(className);
      document.getElementById("damageScaling").textContent = scale;

      document.getElementById("damageScalingTip").textContent =
        scale === "Attack"
          ? "Your weapon attacks and physical skills gain additional damage from Attack."
          : "Your spells and magical skills gain additional damage from Intellect.";
    }

    async function loadClasses() {
      try {
        const res = await fetch("/api/classes");
        const classes = await res.json();

        DB_CLASSES.clear();
        classes.forEach(c => DB_CLASSES.set(c.name, c));

        const select = document.getElementById("class");
        select.innerHTML = "";

        classes.forEach(c => {
          const opt = document.createElement("option");
          opt.value = c.name;
          opt.textContent = c.name;
          select.appendChild(opt);
        });

        setClassPanel(select.value);
        select.addEventListener("change", () => setClassPanel(select.value));
      } catch (err) {
        console.error("Failed to load classes", err);
        document.getElementById("class").innerHTML = "<option>Error loading classes</option>";
        setClassPanel("");
      }
    }

    window.addEventListener("DOMContentLoaded", loadClasses);
  </script>

  <script>
    async function register() {
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("pass1").value;
      const confirm = document.getElementById("pass2").value;
      const pclass = document.getElementById("class").value;

      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, password, confirm, pclass })
      });

      const data = await res.json();

      document.getElementById("msg").innerText =
        data.error || "âœ… Adventurer created. Redirecting...";

      if (data.success) {
        setTimeout(() => window.location = "/login.html", 1200);
      }
    }
  </script>
</body>
</html>
