<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Combat Modal</title>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

  <style>
    /* =======================
       COMBAT MODAL
    ======================= */

    .combat-modal {
    position: fixed;
    inset: 0;
    margin: auto;
    width: 720px;
    background: radial-gradient(circle at top, #1b1205, #050200);
    border: 3px solid gold;
    border-radius: 18px;
    box-shadow: 0 0 40px gold;
    font-family: Cinzel, serif;
    z-index: 9999;
    max-height: 540px;
    display: flex;
    flex-direction: column;
    }

    .combat-modal.hidden {
      display: none;
    }
    .hidden {
    display: none;
    }
    .combat-window {
      width: 520px;
      background: linear-gradient(#1b1205, #050200);
      border: 3px solid gold;
      border-radius: 14px;
      box-shadow: 0 0 30px rgba(255,215,100,.6);
      padding: 14px;
      color: #f5e6b2;
      font-family: Cinzel, serif;
    }

    .combat-header {
    padding: 14px 20px;
    font-size: 22px;
    font-weight: bold;
    color: gold;
    border-bottom: 1px solid #c8a34b;
    }

    .combat-close {
      background: none;
      border: none;
      color: gold;
      font-size: 18px;
      cursor: pointer;
    }

    .combat-body {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

.combat-panel {
  display: grid;
  grid-template-columns: 96px 1fr;
  gap: 14px;
  padding: 12px;
  border: 1px solid #c8a34b;
  border-radius: 12px;
}

    .combat-sub {
      font-size: 12px;
      color: #ccc;
    }

    .stat {
      margin-top: 6px;
      font-size: 14px;
    }

    .combat-log {
    margin: 0 16px;
    padding: 10px;
    height: 110px;
    border: 1px solid #444;
    background: #000;
    overflow-y: auto;

    font-size: 13px;
    flex-shrink: 0;
    }


    .combat-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 10px 0 14px;
    }


    .combat-actions button {
      padding: 8px 18px;
      background: linear-gradient(#6b4226, #332010);
      border: 2px solid gold;
      border-radius: 8px;
      color: #f5d27d;
      font-family: Cinzel, serif;
      cursor: pointer;
    }

    .combat-actions button:hover {
      background: gold;
      color: black;
      box-shadow: 0 0 10px gold;
    }
    /* ===============================
   COMBAT PANELS
================================ */

.combat-panels {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  padding: 16px;
}

.combat-panel {
  display: grid;
  grid-template-columns: 96px 1fr;
  gap: 14px;
  padding: 12px;
  border: 1px solid #c8a34b;
  border-radius: 12px;
  background: radial-gradient(circle at top, #1a1208, #050200);
}

.enemy-panel {
  text-align: right;
}

/* ===============================
   PORTRAITS
================================ */

.portrait-frame {
  width: 96px;
  height: 96px;
  border: 2px solid gold;
  border-radius: 10px;
  overflow: hidden;
}

.portrait-frame.enemy {
  border-color: #c05050;
  box-shadow: 0 0 12px rgba(255,80,80,0.4);
}

.portrait-frame img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===============================
   TEXT
================================ */

.name {
  font-size: 18px;
  font-weight: bold;
  color: gold;
}

.meta {
  font-size: 12px;
  color: #aaa;
  margin-bottom: 6px;
}

/* ===============================
   BARS
================================ */

.bar-group {
  margin-top: 8px;
}

.bar-label {
  font-size: 11px;
  color: #e6c87a;
  margin-bottom: 2px;
}

.bar {
  position: relative;          /* anchor for fill */
  height: 14px;
  background: #1a1a1a;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid #333;
}

/* IMPORTANT: left-anchored fill */
.bar-fill {
  position: absolute;
  left: 0;
  top: 0;

  height: 100%;
  width: 100%;

  transition: width 0.3s ease;
}

.bar-fill.hp {
  background: linear-gradient(to right, #8b0000, #ff4040);
}

.bar-fill.sp {
  background: linear-gradient(to right, #1b3d8b, #4fa3ff);
}


.bar-fill.enemy {
  background: linear-gradient(to right, #4b0000, #c02020);
}

.bar-text {
  font-size: 11px;
  color: #ccc;
  margin-top: 2px;
}

.combat-btn {
  padding: 10px 22px;
  font-size: 15px;
  font-family: Cinzel, serif;
  border-radius: 10px;
  border: 2px solid gold;
  background: linear-gradient(#3a2b18, #120a04);
  color: gold;
  cursor: pointer;
}
.combat-btn:hover {
  box-shadow: 0 0 12px gold;
  transform: scale(1.05);
}
.sub-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.85);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.sub-modal.hidden {
  display: none;
}

.sub-modal-box {
  width: 420px;
  background: #0a0806;
  border: 2px solid gold;
  border-radius: 12px;
  padding: 16px;
}
/* Generic modal overlay */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* Hide helper */
.hidden {
  display: none !important;
}

/* Modal window */
.modal-window {
  background: linear-gradient(#1b1205, #050200);
  border: 3px solid gold;
  border-radius: 14px;
  padding: 20px;
  min-width: 320px;
  max-width: 480px;
  max-height: 70vh;
  overflow-y: auto;
  box-shadow: 0 0 25px black;
}

.modal-window.small {
  width: 420px;
}

/* Spell grid */
.spell-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}

.spell-slot {
  padding: 10px;
  border: 2px solid #c8a34b;
  border-radius: 8px;
  background: #120a04;
  cursor: pointer;
}

.spell-slot:hover {
  background: #3a2b18;
}
.spell-slot {
  display: grid !important;
  grid-template-columns: 48px 1fr;
  align-items: center;
  gap: 12px;

  padding: 12px;
  border: 1px solid #c8a34b;
  background: linear-gradient(#1b1205, #050200);
  text-align: left !important;
}



.spell-slot:hover {
  background: linear-gradient(#3b2614, #1a1008);
}

/* The box defines the size */
.spell-icon-wrapper {
  width: 48px;
  height: 48px;
  min-width: 48px;
  min-height: 48px;
  max-width: 48px;
  max-height: 48px;

  overflow: hidden;
  position: relative;
  flex-shrink: 0;

  border: 1px solid #3a2a12;
  border-radius: 6px;
  background: #050200;
}
/* The image is FORCED to obey the box */
.spell-icon-wrapper img {
  width: 100% !important;
  height: 100% !important;

  max-width: 100% !important;
  max-height: 100% !important;

  object-fit: contain !important;
  display: block !important;
}

.spell-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.cooldown-text {
  font-size: 12px;
  opacity: 0.8;
}

/* COOLDOWN OVERLAY */
.spell-cooldown {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  color: gold;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  pointer-events: none;
}

.spell-cooldown.hidden {
  display: none;
}
/* ==== FORCE SPELL ROW LAYOUT (wins cascade) ==== */
#combatSpellsGrid .spell-slot {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  justify-content: flex-start !important;
}

#combatSpellsGrid .spell-icon-wrapper {
  flex: 0 0 48px !important;   /* fixed icon column */
  width: 48px !important;
  height: 48px !important;
}

#combatSpellsGrid .spell-info {
  text-align: left !important;
  width: auto !important;
}
#combatSpellsGrid {
  display: block !important;
  flex-direction: column !important;
  align-items: stretch !important;
  gap: 8px;
  text-align: left !important;
}

.spell-slot.on-cooldown {
  opacity: 0.55;
  pointer-events: none;
}

.spell-slot.on-cooldown .spell-icon-wrapper {
  filter: grayscale(100%);
}

  </style>
</head>

<body>

<div id="combatModal" class="combat-modal hidden">

  <!-- HEADER -->
  <div class="combat-header">
    ‚öî Combat Encounter
  </div>

  <!-- PANELS -->
  <div class="combat-panels">

    <!-- PLAYER -->
    <div class="combat-panel player-panel">
      <div class="portrait-frame">
        <img id="playerPortrait" src="/images/portraits/default.png">
      </div>

      <div class="panel-info">
        <div id="playerName" class="name"></div>
        <div class="meta">
          <span id="playerClass"></span> ¬∑ Lv <span id="playerLevel"></span>
        </div>

        <div class="bar-group">
          <div class="bar-label">‚ù§Ô∏è HP</div>
          <div class="bar">
            <div id="playerHPBar" class="bar-fill hp"></div>
          </div>
          <div class="bar-text">
            <span id="playerHP"></span> / <span id="playerMaxHP"></span>
          </div>
        </div>

        <div class="bar-group">
          <div class="bar-label">‚ú® SP</div>
          <div class="bar">
            <div id="playerSPBar" class="bar-fill sp"></div>
          </div>
          <div class="bar-text">
            <span id="playerSP"></span> / <span id="playerMaxSP"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- ENEMY -->
    <div class="combat-panel enemy-panel">
      <div class="portrait-frame enemy">
        <img id="enemyPortrait" src="/images/portraits/default_enemy.png">
      </div>

      <div class="panel-info right">
        <div id="enemyName" class="name enemy-name"></div>

        <div class="bar-group">
          <div class="bar-label">‚ò† HP</div>
          <div class="bar">
            <div id="enemyHPBar" class="bar-fill hp enemy"></div>
          </div>
          <div class="bar-text">
            <span id="enemyHP"></span> / <span id="enemyMaxHP"></span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- COMBAT LOG -->
  <div id="combatLog" class="combat-log"></div>

  <!-- ACTIONS -->
    <div class="combat-actions">
        <button onclick="combatAttack()">‚öî Attack</button>
        <button onclick="openItemsModal()">üéí Items</button>
        <button onclick="openSpellsModal()">‚ú® Spells</button>
        <button onclick="combatFlee()">üèÉ Flee</button>
    </div>

</div>
<div id="itemsModal" class="sub-modal hidden">
  <div class="sub-modal-box">
    <h3>üéí Items</h3>

    <div id="combatItemsGrid" class="items-grid"></div>

    <button onclick="closeItemsModal()">Close</button>
  </div>
</div>
<!-- SPELLS MODAL -->
<div id="spellsModal" class="modal-overlay hidden">
  <div class="modal-window small">
    <h2>üìñ Spellbook</h2>

    <div id="combatSpellsGrid" class="spell-grid">
      <!-- spells injected here -->
    </div>

    <button class="modal-btn" onclick="closeSpellsModal()">Close</button>
  </div>
</div>



</body>
</html>
